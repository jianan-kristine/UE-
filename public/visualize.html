<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¯è§†åŒ–åˆ†æ - CompLens</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0e1a;
      color: #e5e7eb;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #0f1419;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      padding: 20px;
      border: 1px solid #1f2937;
    }

    .header {
      text-align: center;
      padding: 40px 20px 30px;
      position: relative;
      border-bottom: 1px solid #1f2937;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 32px;
      font-weight: 300;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }

    .language-selector {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 8px;
    }

    .lang-btn {
      padding: 8px 14px;
      border: 1px solid #1f2937;
      background: transparent;
      color: #9ca3af;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .lang-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }

    .lang-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .back-button {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      border: 2px solid #667eea;
      background: transparent;
      color: #667eea;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .back-button:hover {
      background: #667eea;
      color: white;
      transform: translateX(-2px);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .card {
      background: #0a0e1a;
      border-radius: 8px;
      padding: 24px;
      border: 1px solid #1f2937;
      transition: all 0.3s;
      margin-bottom: 20px;
    }

    .card:hover {
      box-shadow: 0 4px 12px rgba(102,126,234,0.2);
      border-color: #667eea;
    }

    .card h2 {
      font-size: 18px;
      margin-bottom: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #e5e7eb;
      padding-bottom: 12px;
      border-bottom: 1px solid #1f2937;
    }

    .card-icon {
      font-size: 22px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(102,126,234,0.1);
      color: #667eea;
      font-size: 13px;
      margin: 4px 6px 4px 0;
      border: 1px solid rgba(102,126,234,0.3);
      font-weight: 500;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      margin-right: 6px;
      background: #667eea;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 14px;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #1f2937;
    }

    th {
      color: #9ca3af;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: #1f2937;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover {
      background: rgba(102,126,234,0.05);
    }

    a {
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
    }

    a:hover {
      text-decoration: underline;
    }

    .tag {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(240,147,251,0.1);
      color: #f093fb;
      font-size: 13px;
      margin: 6px 6px 6px 0;
      border: 1px solid rgba(240,147,251,0.3);
      font-weight: 500;
    }

    .section-title {
      font-size: 12px;
      color: #9ca3af;
      margin: 16px 0 8px 0;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }

    .summary-text {
      line-height: 1.7;
      color: #d1d5db;
      font-size: 15px;
    }

    ul {
      margin: 12px 0;
      padding-left: 20px;
    }

    li {
      margin: 6px 0;
      color: #d1d5db;
      font-size: 14px;
      line-height: 1.6;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 28px;
      }
    }

    .persona-reviews-section {
      margin-top: 60px;
      padding: 40px 0;
      border-top: 1px solid rgba(148, 163, 184, 0.2);
    }

    .persona-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }

    .persona-card {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.6) 100%);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      transition: all 0.3s ease;
    }

    .persona-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      border-color: rgba(99, 102, 241, 0.5);
    }

    .persona-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .persona-icon {
      font-size: 32px;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: rgba(99, 102, 241, 0.1);
    }

    .persona-card.pm .persona-icon {
      background: rgba(59, 130, 246, 0.1);
    }

    .persona-card.vc .persona-icon {
      background: rgba(34, 197, 94, 0.1);
    }

    .persona-card.growth .persona-icon {
      background: rgba(249, 115, 22, 0.1);
    }

    .persona-card.tech .persona-icon {
      background: rgba(168, 85, 247, 0.1);
    }

    .persona-card-title {
      flex: 1;
    }

    .persona-card-title h3 {
      margin: 0 0 4px 0;
      font-size: 20px;
      color: #f1f5f9;
    }

    .persona-card-title .subtitle {
      font-size: 13px;
      color: #94a3b8;
    }

    .persona-card-content {
      color: #e2e8f0;
      line-height: 1.6;
      font-size: 14px;
    }

    .persona-card-content p {
      margin: 0 0 12px 0;
    }

    .persona-card-content ul {
      margin: 8px 0;
      padding-left: 20px;
    }

    .persona-card-content li {
      margin: 4px 0;
    }

    .persona-rating {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(148, 163, 184, 0.2);
    }

    .rating-label {
      font-size: 13px;
      color: #94a3b8;
    }

    .rating-stars {
      color: #fbbf24;
      font-size: 16px;
    }

    // ...existing styles...
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <button class="back-button" id="backButton">
        <span>â†</span>
        <span data-i18n="backButton">è¿”å›ä¸»é¡µ</span>
      </button>
      <div class="language-selector">
        <button class="lang-btn active" data-lang="zh">ä¸­æ–‡</button>
        <button class="lang-btn" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="ja">æ—¥æœ¬èª</button>
      </div>
      <h1 data-i18n="pageTitle">ğŸ“Š å¯è§†åŒ–ç«å“åˆ†æ</h1>
      
      <!-- Persona é€‰æ‹©å™¨ -->
      <div style="margin-top: 20px;">
        <select id="personaSelector" onchange="filterByPersona()" style="padding: 10px 16px; border-radius: 8px; border: 2px solid #667eea; background: rgba(102,126,234,0.1); color: #e5e7eb; font-size: 14px; font-weight: 500; cursor: pointer; outline: none;">
          <option value="all">ğŸ‘¥ æ˜¾ç¤ºæ‰€æœ‰è§†è§’</option>
          <option value="pm">ğŸ“Š äº§å“ç»ç†è§†è§’</option>
          <option value="vc">ğŸ’° æŠ•èµ„äººè§†è§’</option>
          <option value="growth">ğŸ“ˆ å¢é•¿è´Ÿè´£äººè§†è§’</option>
          <option value="tech">âš™ï¸ æŠ€æœ¯è´Ÿè´£äººè§†è§’</option>
        </select>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2><span class="card-icon">ğŸ’¡</span> <span data-i18n="productOverview">äº§å“æ¦‚è¿°</span></h2>
        <div class="section-title" data-i18n="ideaSummary">Idea Summary</div>
        <div class="summary-text" id="ideaSummary"></div>

        <div class="section-title" style="margin-top:20px;" data-i18n="targetUsers">Target Users</div>
        <div id="targetUsers"></div>

        <div class="section-title" style="margin-top:20px;" data-i18n="keyProblems">Key Problems</div>
        <div id="problems"></div>
      </div>

      <div class="card">
        <h2><span class="card-icon">ğŸ¯</span> <span data-i18n="opportunities">æœºä¼šä¸å·®å¼‚åŒ–</span></h2>
        <div id="opportunities"></div>
      </div>
    </div>

    <!-- å¸‚åœºæ•°æ®å¡ç‰‡ -->
    <div class="card" style="margin-top:20px;" id="marketDataCard">
      <h2><span class="card-icon">ğŸ“ˆ</span> <span data-i18n="marketData">å¸‚åœºæ•°æ®</span></h2>
      <div style="margin-bottom:20px;" id="marketMetrics"></div>
      <div style="max-width:800px;margin:0 auto;">
        <canvas id="marketChart"></canvas>
      </div>
    </div>

    <div class="card" style="margin-top:20px;">
      <h2><span class="card-icon">ğŸ¢</span> <span data-i18n="directCompetitors">ç›´æ¥ç«äº‰å¯¹æ‰‹</span></h2>
      <div id="directCompetitors"></div>
    </div>

    <div class="card" style="margin-top:20px;">
      <h2><span class="card-icon">ğŸ”„</span> <span data-i18n="adjacentCompetitors">é—´æ¥ç«äº‰ / æ›¿ä»£æ–¹æ¡ˆ</span></h2>
      <div id="adjacentCompetitors"></div>
    </div>

    <!-- Persona Reviews Section -->
    <div class="persona-reviews-section">
      <h2 class="section-title" id="personaReviewsTitle">ğŸ‘¥ Persona Reviews</h2>
      <div id="personaReviewsContainer" class="persona-cards-grid"></div>
    </div>

  </div>

  <script>
    // å¤šè¯­è¨€ç¿»è¯‘
    const translations = {
      zh: {
        backButton: 'è¿”å›ä¸»é¡µ',
        pageTitle: 'ğŸ“Š å¯è§†åŒ–ç«å“åˆ†æ',
        productOverview: 'äº§å“æ¦‚è¿°',
        ideaSummary: 'äº§å“æ¦‚è¦',
        targetUsers: 'ç›®æ ‡ç”¨æˆ·',
        keyProblems: 'æ ¸å¿ƒé—®é¢˜',
        opportunities: 'æœºä¼šä¸å·®å¼‚åŒ–',
        marketData: 'å¸‚åœºæ•°æ®',
        currentMarketSize: 'å½“å‰å¸‚åœºè§„æ¨¡',
        projectedMarketSize: 'é¢„è®¡å¸‚åœºè§„æ¨¡',
        growthRate: 'å¤åˆå¹´å¢é•¿ç‡',
        marketGrowthTrend: 'å¸‚åœºå¢é•¿è¶‹åŠ¿',
        directCompetitors: 'ç›´æ¥ç«äº‰å¯¹æ‰‹',
        adjacentCompetitors: 'é—´æ¥ç«äº‰ / æ›¿ä»£æ–¹æ¡ˆ',
        name: 'åç§°',
        url: 'URL',
        targetUsersLabel: 'ç›®æ ‡ç”¨æˆ·',
        keyFeatures: 'æ ¸å¿ƒåŠŸèƒ½',
        pricing: 'å®šä»·',
        differentiation: 'å·®å¼‚åŒ–',
        notes: 'å¤‡æ³¨',
        noDirectCompetitors: 'æœªæ‰¾åˆ°ç›´æ¥ç«äº‰å¯¹æ‰‹',
        noAdjacentCompetitors: 'æœªæ‰¾åˆ°é—´æ¥ç«äº‰å¯¹æ‰‹'
      },
      en: {
        backButton: 'Back to Home',
        pageTitle: 'ğŸ“Š Competitive Analysis Visualization',
        productOverview: 'Product Overview',
        ideaSummary: 'Idea Summary',
        targetUsers: 'Target Users',
        keyProblems: 'Key Problems',
        opportunities: 'Opportunities & Differentiation',
        marketData: 'Market Data',
        currentMarketSize: 'Current Market Size',
        projectedMarketSize: 'Projected Market Size',
        growthRate: 'CAGR',
        marketGrowthTrend: 'Market Growth Trend',
        directCompetitors: 'Direct Competitors',
        adjacentCompetitors: 'Adjacent Competitors / Alternatives',
        name: 'Name',
        url: 'URL',
        targetUsersLabel: 'Target Users',
        keyFeatures: 'Key Features',
        pricing: 'Pricing',
        differentiation: 'Differentiation',
        notes: 'Notes',
        noDirectCompetitors: 'No direct competitors found',
        noAdjacentCompetitors: 'No adjacent competitors found'
      },
      ja: {
        backButton: 'ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹',
        pageTitle: 'ğŸ“Š ç«¶åˆåˆ†æã®è¦–è¦šåŒ–',
        productOverview: 'è£½å“æ¦‚è¦',
        ideaSummary: 'è£½å“ã‚µãƒãƒªãƒ¼',
        targetUsers: 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
        keyProblems: 'ä¸»è¦ãªèª²é¡Œ',
        opportunities: 'æ©Ÿä¼šã¨å·®åˆ¥åŒ–',
        marketData: 'å¸‚å ´ãƒ‡ãƒ¼ã‚¿',
        currentMarketSize: 'ç¾åœ¨ã®å¸‚å ´è¦æ¨¡',
        projectedMarketSize: 'äºˆæ¸¬å¸‚å ´è¦æ¨¡',
        growthRate: 'å¹´å¹³å‡æˆé•·ç‡',
        marketGrowthTrend: 'å¸‚å ´æˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰',
        directCompetitors: 'ç›´æ¥ç«¶åˆ',
        adjacentCompetitors: 'é–“æ¥ç«¶åˆ / ä»£æ›¿æ¡ˆ',
        name: 'åå‰',
        url: 'URL',
        targetUsersLabel: 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
        keyFeatures: 'ä¸»è¦æ©Ÿèƒ½',
        pricing: 'ä¾¡æ ¼è¨­å®š',
        differentiation: 'å·®åˆ¥åŒ–',
        notes: 'å‚™è€ƒ',
        noDirectCompetitors: 'ç›´æ¥ç«¶åˆã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
        noAdjacentCompetitors: 'é–“æ¥ç«¶åˆã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'
      }
    };

    let currentLang = 'zh';

    function setLanguage(lang) {
      currentLang = lang;
      document.querySelectorAll('[data-i18n]').forEach(elem => {
        const key = elem.getAttribute('data-i18n');
        if (translations[lang][key]) {
          elem.textContent = translations[lang][key];
        }
      });
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
      });
      // é‡æ–°æ¸²æŸ“ç«äº‰å¯¹æ‰‹è¡¨æ ¼å’Œå¸‚åœºæ•°æ®(ä½¿ç”¨æ–°è¯­è¨€çš„è¡¨å¤´)
      if (window.currentData) {
        renderMarketData(window.currentData.market_data);
        renderDirectCompetitors(window.currentData.direct_competitors);
        renderAdjacentCompetitors(window.currentData.adjacent_competitors);
      }
    }

    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        setLanguage(btn.getAttribute('data-lang'));
      });
    });

    // ä» sessionStorage è·å–æ•°æ®å’Œè¯­è¨€è®¾ç½®
    const dataString = sessionStorage.getItem('visualizationData');
    const savedLang = sessionStorage.getItem('visualizationLang') || 'zh';

    // è®¾ç½®è¯­è¨€(åœ¨æ¸²æŸ“æ•°æ®ä¹‹å‰)
    setLanguage(savedLang);

    if (!dataString) {
      document.body.innerHTML = '<div style="text-align:center;padding:100px;color:#e5e7eb;background:#0a0e1a;min-height:100vh;"><h1 style="font-size:24px;font-weight:300;margin-bottom:10px;">âŒ No data provided</h1><p style="color:#9ca3af;">Please navigate from the main page.</p></div>';
    } else {
      try {
        const data = JSON.parse(dataString);
        renderVisualization(data);
        // æ¸…é™¤ sessionStorage æ•°æ®(å¯é€‰)
        // sessionStorage.removeItem('visualizationData');
        // sessionStorage.removeItem('visualizationLang');
      } catch (e) {
        document.body.innerHTML = '<div style="text-align:center;padding:100px;color:#e5e7eb;background:#0a0e1a;min-height:100vh;"><h1 style="font-size:24px;font-weight:300;margin-bottom:10px;">âŒ Error parsing data</h1><p style="color:#9ca3af;">' + e.message + '</p></div>';
      }
    }

    function renderVisualization(data) {
      // ä¿å­˜æ•°æ®ä»¥ä¾¿è¯­è¨€åˆ‡æ¢æ—¶ä½¿ç”¨
      window.currentData = data;

      // Render idea summary
      if (data.idea_summary) {
        document.getElementById('ideaSummary').textContent = data.idea_summary;
      }

      // Render target users
      if (Array.isArray(data.target_users)) {
        const targetDiv = document.getElementById('targetUsers');
        data.target_users.forEach(u => {
          const pill = document.createElement('div');
          pill.className = 'pill';
          pill.innerHTML = `<span class="pill-dot"></span>${u}`;
          targetDiv.appendChild(pill);
        });
      }

      // Render problems
      if (Array.isArray(data.problem)) {
        const problemsDiv = document.getElementById('problems');
        const ul = document.createElement('ul');
        data.problem.forEach(p => {
          const li = document.createElement('li');
          li.textContent = p;
          ul.appendChild(li);
        });
        problemsDiv.appendChild(ul);
      }

      // Render opportunities
      if (Array.isArray(data.opportunities)) {
        const oppDiv = document.getElementById('opportunities');
        data.opportunities.forEach(o => {
          const tag = document.createElement('div');
          tag.className = 'tag';
          tag.textContent = o;
          oppDiv.appendChild(tag);
        });
      }

      // Render market data
      renderMarketData(data.market_data);

      // Render direct competitors
      renderDirectCompetitors(data.direct_competitors);

      // Render adjacent competitors
      renderAdjacentCompetitors(data.adjacent_competitors);

      // Render Persona Reviews
      renderPersonaReviews(data);
    }

    function renderDirectCompetitors(competitors) {
      const container = document.getElementById('directCompetitors');
      if (!Array.isArray(competitors) || competitors.length === 0) {
        container.innerHTML = `<p style="color:#666;font-size:14px;text-align:center;padding:20px;">${translations[currentLang].noDirectCompetitors}</p>`;
        return;
      }

      container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
      const table = document.createElement('table');
      table.innerHTML = `
        <thead>
          <tr>
            <th>${translations[currentLang].name}</th>
            <th>${translations[currentLang].targetUsersLabel}</th>
            <th>${translations[currentLang].keyFeatures}</th>
            <th>${translations[currentLang].pricing}</th>
            <th>${translations[currentLang].differentiation}</th>
          </tr>
        </thead>
        <tbody>
          ${competitors.map(c => `
            <tr>
              <td>${c.url ? `<a href="${c.url}" target="_blank">${c.name || 'N/A'}</a>` : (c.name || 'N/A')}</td>
              <td>${Array.isArray(c.target_users) ? c.target_users.join(', ') : (c.target_users || '')}</td>
              <td>${Array.isArray(c.key_features) ? c.key_features.join('; ') : (c.key_features || '')}</td>
              <td>${c.pricing_summary || ''}</td>
              <td>${c.differentiation || ''}</td>
            </tr>
          `).join('')}
        </tbody>
      `;
      container.appendChild(table);
    }

    function renderAdjacentCompetitors(competitors) {
      const container = document.getElementById('adjacentCompetitors');
      if (!Array.isArray(competitors) || competitors.length === 0) {
        container.innerHTML = `<p style="color:#666;font-size:14px;text-align:center;padding:20px;">${translations[currentLang].noAdjacentCompetitors}</p>`;
        return;
      }

      container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
      const table = document.createElement('table');
      table.innerHTML = `
        <thead>
          <tr>
            <th>${translations[currentLang].name}</th>
            <th>${translations[currentLang].url}</th>
            <th>${translations[currentLang].notes}</th>
          </tr>
        </thead>
        <tbody>
          ${competitors.map(c => `
            <tr>
              <td>${c.name || 'N/A'}</td>
              <td>${c.url ? `<a href="${c.url}" target="_blank">${c.url}</a>` : ''}</td>
              <td>${c.notes || ''}</td>
            </tr>
          `).join('')}
        </tbody>
      `;
      container.appendChild(table);
    }

    function renderMarketData(marketData) {
      const card = document.getElementById('marketDataCard');

      if (!marketData) {
        card.style.display = 'none';
        return;
      }

      card.style.display = 'block';

      // Render market metrics
      const metricsDiv = document.getElementById('marketMetrics');
      metricsDiv.innerHTML = '';

      const metrics = [];
      if (marketData.market_size_current) {
        metrics.push(`<div style="display:inline-block;margin-right:30px;margin-bottom:15px;">
          <div style="color:#9ca3af;font-size:13px;margin-bottom:5px;">${translations[currentLang].currentMarketSize}</div>
          <div style="color:#667eea;font-size:20px;font-weight:600;">${marketData.market_size_current}</div>
        </div>`);
      }
      if (marketData.market_size_projected) {
        metrics.push(`<div style="display:inline-block;margin-right:30px;margin-bottom:15px;">
          <div style="color:#9ca3af;font-size:13px;margin-bottom:5px;">${translations[currentLang].projectedMarketSize}</div>
          <div style="color:#667eea;font-size:20px;font-weight:600;">${marketData.market_size_projected}</div>
        </div>`);
      }
      if (marketData.cagr) {
        metrics.push(`<div style="display:inline-block;margin-right:30px;margin-bottom:15px;">
          <div style="color:#9ca3af;font-size:13px;margin-bottom:5px;">${translations[currentLang].growthRate}</div>
          <div style="color:#10b981;font-size:20px;font-weight:600;">${marketData.cagr}</div>
        </div>`);
      }

      metricsDiv.innerHTML = metrics.join('');

      // Render chart
      if (Array.isArray(marketData.growth_timeline) && marketData.growth_timeline.length > 0) {
        const ctx = document.getElementById('marketChart').getContext('2d');

        // Destroy existing chart if any
        if (window.marketChartInstance) {
          window.marketChartInstance.destroy();
        }

        const years = marketData.growth_timeline.map(d => d.year);
        const values = marketData.growth_timeline.map(d => d.value);

        window.marketChartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: years,
            datasets: [{
              label: translations[currentLang].marketGrowthTrend,
              data: values,
              borderColor: '#667eea',
              backgroundColor: 'rgba(102, 126, 234, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointRadius: 5,
              pointHoverRadius: 7,
              pointBackgroundColor: '#667eea',
              pointBorderColor: '#fff',
              pointBorderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#e5e7eb',
                  font: { size: 14 }
                }
              },
              tooltip: {
                backgroundColor: '#1f2937',
                titleColor: '#e5e7eb',
                bodyColor: '#e5e7eb',
                borderColor: '#374151',
                borderWidth: 1,
                padding: 12,
                displayColors: false,
                callbacks: {
                  label: function(context) {
                    return `${context.parsed.y} billion USD`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: '#374151',
                  drawBorder: false
                },
                ticks: {
                  color: '#9ca3af',
                  font: { size: 12 },
                  callback: function(value) {
                    return '$' + value + 'B';
                  }
                }
              },
              x: {
                grid: {
                  color: '#374151',
                  drawBorder: false
                },
                ticks: {
                  color: '#9ca3af',
                  font: { size: 12 }
                }
              }
            }
          }
        });
      }
    }

    // Render Persona Reviews
    function renderPersonaReviews(data) {
      const container = document.getElementById('personaReviewsContainer');
      if (!container) return;

      // Persona é…ç½®
      const personas = [
        {
          id: 'pm',
          icon: 'ğŸ“Š',
          titleEN: 'Product Manager',
          titleZH: 'äº§å“ç»ç†è§†è§’',
          titleJA: 'ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼',
          subtitleEN: 'Feature & Roadmap Focus',
          subtitleZH: 'åŠŸèƒ½ä¸è·¯çº¿å›¾',
          subtitleJA: 'æ©Ÿèƒ½ã¨ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—',
        },
        {
          id: 'vc',
          icon: 'ğŸ’°',
          titleEN: 'Investor / VC',
          titleZH: 'æŠ•èµ„äººè§†è§’',
          titleJA: 'æŠ•è³‡å®¶ãƒ»VC',
          subtitleEN: 'Market & Business Model',
          subtitleZH: 'å¸‚åœºä¸å•†ä¸šæ¨¡å¼',
          subtitleJA: 'å¸‚å ´ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«',
        },
        {
          id: 'growth',
          icon: 'ğŸ“ˆ',
          titleEN: 'Growth Lead',
          titleZH: 'å¢é•¿è´Ÿè´£äººè§†è§’',
          titleJA: 'ã‚°ãƒ­ãƒ¼ã‚¹ãƒªãƒ¼ãƒ‰',
          subtitleEN: 'Acquisition & Retention',
          subtitleZH: 'è·å®¢ä¸ç•™å­˜',
          subtitleJA: 'ç²å¾—ã¨ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³',
        },
        {
          id: 'tech',
          icon: 'âš™ï¸',
          titleEN: 'Tech Lead',
          titleZH: 'æŠ€æœ¯è´Ÿè´£äººè§†è§’',
          titleJA: 'ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰',
          subtitleEN: 'Architecture & Implementation',
          subtitleZH: 'æ¶æ„ä¸å®ç°',
          subtitleJA: 'ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨å®Ÿè£…',
        },
      ];

      const lang = localStorage.getItem('visualizationLang') || 'en';

      // æ›´æ–°æ ‡é¢˜
      const titleEl = document.getElementById('personaReviewsTitle');
      if (titleEl) {
        const titles = {
          en: 'ğŸ‘¥ Persona Reviews',
          zh: 'ğŸ‘¥ ä¸åŒè§’è‰²è§†è§’è¯„ä»·',
          ja: 'ğŸ‘¥ ãƒšãƒ«ã‚½ãƒŠåˆ¥ãƒ¬ãƒ“ãƒ¥ãƒ¼',
        };
        titleEl.textContent = titles[lang] || titles.en;
      }

      container.innerHTML = '';

      personas.forEach(persona => {
        const card = document.createElement('div');
        card.className = `persona-card ${persona.id}`;

        // è·å– persona insightï¼ˆå¦‚æœæœ‰ï¼‰
        let content = '';
        if (data.personaInsights && data.personaInsights[persona.id]) {
          content = data.personaInsights[persona.id];
        } else {
          // ç”Ÿæˆé»˜è®¤å†…å®¹
          content = generateDefaultPersonaContent(persona.id, data, lang);
        }

        // æ ‡é¢˜
        const title = lang === 'zh' ? persona.titleZH : 
                      lang === 'ja' ? persona.titleJA : 
                      persona.titleEN;
        const subtitle = lang === 'zh' ? persona.subtitleZH : 
                         lang === 'ja' ? persona.subtitleJA : 
                         persona.subtitleEN;

        // ç”Ÿæˆè¯„åˆ†ï¼ˆåŸºäºæ•°æ®ï¼‰
        const rating = calculatePersonaRating(persona.id, data);

        card.innerHTML = `
          <div class="persona-card-header">
            <div class="persona-icon">${persona.icon}</div>
            <div class="persona-card-title">
              <h3>${title}</h3>
              <div class="subtitle">${subtitle}</div>
            </div>
          </div>
          <div class="persona-card-content">
            ${content}
          </div>
          <div class="persona-rating">
            <span class="rating-label">${lang === 'zh' ? 'æ¨èåº¦' : lang === 'ja' ? 'æ¨å¥¨åº¦' : 'Rating'}:</span>
            <span class="rating-stars">${'â˜…'.repeat(rating)}${'â˜†'.repeat(5 - rating)}</span>
          </div>
        `;

        container.appendChild(card);
      });
    }

    // ç”Ÿæˆé»˜è®¤ Persona å†…å®¹
    function generateDefaultPersonaContent(personaId, data, lang) {
      const competitors = data.direct_competitors || [];
      const opportunities = data.opportunities || [];
      const risks = data.risks || [];
      const differentiation = data.differentiation || '';

      if (lang === 'zh') {
        switch (personaId) {
          case 'pm':
            return `
              <p><strong>äº§å“å®šä½ï¼š</strong>${data.idea_summary || 'åˆ›æ–°äº§å“æ–¹æ¡ˆ'}</p>
              <p><strong>æ ¸å¿ƒç«äº‰åŠ›ï¼š</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>å¾…è¿›ä¸€æ­¥åˆ†æ</li>'}
              </ul>
              <p><strong>å»ºè®®ï¼š</strong>é‡ç‚¹å…³æ³¨æ ¸å¿ƒåŠŸèƒ½çš„å·®å¼‚åŒ–ï¼Œå»ºç«‹æ¸…æ™°çš„äº§å“è·¯çº¿å›¾ã€‚</p>
            `;
          case 'vc':
            return `
              <p><strong>å¸‚åœºç©ºé—´ï¼š</strong>${data.market_data?.market_size_current || 'ä¸­ç­‰è§„æ¨¡å¸‚åœº'}</p>
              <p><strong>ç«äº‰æ ¼å±€ï¼š</strong>å½“å‰æœ‰ ${competitors.length} ä¸ªä¸»è¦ç«å“</p>
              <p><strong>æŠ•èµ„ä»·å€¼ï¼š</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>éœ€è¯„ä¼°å•†ä¸šæ¨¡å¼</li>'}
              </ul>
              <p><strong>å»ºè®®ï¼š</strong>éœ€è¦æ¸…æ™°çš„å•†ä¸šæ¨¡å¼å’Œå¯éªŒè¯çš„å¢é•¿æŒ‡æ ‡ã€‚</p>
            `;
          case 'growth':
            return `
              <p><strong>ç›®æ ‡ç”¨æˆ·ï¼š</strong>${data.target_users?.slice(0, 2).join('ã€') || 'å¾…æ˜ç¡®'}</p>
              <p><strong>è·å®¢æ¸ é“ï¼š</strong>éœ€è¦æ ¹æ®ç«å“åˆ†æåˆ¶å®šè·å®¢ç­–ç•¥</p>
              <p><strong>å¢é•¿æœºä¼šï¼š</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>å¾…å‘æ˜å¢é•¿ç‚¹</li>'}
              </ul>
              <p><strong>å»ºè®®ï¼š</strong>ä» MVP å¼€å§‹ï¼Œå¿«é€ŸéªŒè¯ç”¨æˆ·è·å–å’Œç•™å­˜ç­–ç•¥ã€‚</p>
            `;
          case 'tech':
            return `
              <p><strong>æŠ€æœ¯å¤æ‚åº¦ï¼š</strong>ä¸­ç­‰ï¼ˆåŸºäºç«å“åˆ†æï¼‰</p>
              <p><strong>å…³é”®æŠ€æœ¯æŒ‘æˆ˜ï¼š</strong></p>
              <ul>
                ${risks.slice(0, 2).map(risk => `<li>${risk}</li>`).join('') || '<li>éœ€è¯„ä¼°æŠ€æœ¯æ ˆ</li>'}
              </ul>
              <p><strong>å»ºè®®ï¼š</strong>ä¼˜å…ˆè€ƒè™‘å¯æ‰©å±•çš„æ¶æ„è®¾è®¡ï¼Œè¯„ä¼°ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆçš„å¯è¡Œæ€§ã€‚</p>
            `;
        }
      } else if (lang === 'ja') {
        switch (personaId) {
          case 'pm':
            return `
              <p><strong>ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ï¼š</strong>${data.idea_summary || 'é©æ–°çš„ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³'}</p>
              <p><strong>ã‚³ã‚¢ç«¶äº‰åŠ›ï¼š</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>ã•ã‚‰ãªã‚‹åˆ†æãŒå¿…è¦</li>'}
              </ul>
              <p><strong>ææ¡ˆï¼š</strong>ã‚³ã‚¢æ©Ÿèƒ½ã®å·®åˆ¥åŒ–ã«æ³¨åŠ›ã—ã€æ˜ç¢ºãªãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚’ç­–å®šã™ã‚‹ã“ã¨ã€‚</p>
            `;
          case 'vc':
            return `
              <p><strong>å¸‚å ´è¦æ¨¡ï¼š</strong>${data.market_data?.market_size_current || 'ä¸­è¦æ¨¡å¸‚å ´'}</p>
              <p><strong>ç«¶åˆçŠ¶æ³ï¼š</strong>ç¾åœ¨ ${competitors.length} ã®ä¸»è¦ç«¶åˆã‚ã‚Š</p>
              <p><strong>æŠ•è³‡ä¾¡å€¤ï¼š</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã®è©•ä¾¡ãŒå¿…è¦</li>'}
              </ul>
              <p><strong>ææ¡ˆï¼š</strong>æ˜ç¢ºãªãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã¨æ¤œè¨¼å¯èƒ½ãªæˆé•·æŒ‡æ¨™ãŒå¿…è¦ã€‚</p>
            `;
          case 'growth':
            return `
              <p><strong>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼š</strong>${data.target_users?.slice(0, 2).join('ã€') || 'æœªç¢ºå®š'}</p>
              <p><strong>ç²å¾—ãƒãƒ£ãƒãƒ«ï¼š</strong>ç«¶åˆåˆ†æã«åŸºã¥ãæˆ¦ç•¥ç­–å®šãŒå¿…è¦</p>
              <p><strong>æˆé•·æ©Ÿä¼šï¼š</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>æˆé•·ãƒã‚¤ãƒ³ãƒˆã®ç™ºæ˜ãŒå¿…è¦</li>'}
              </ul>
              <p><strong>ææ¡ˆï¼š</strong>MVPã‹ã‚‰é–‹å§‹ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç²å¾—ã¨ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³æˆ¦ç•¥ã‚’è¿…é€Ÿã«æ¤œè¨¼ã™ã‚‹ã“ã¨ã€‚</p>
            `;
          case 'tech':
            return `
              <p><strong>æŠ€è¡“çš„è¤‡é›‘åº¦ï¼š</strong>ä¸­ç¨‹åº¦ï¼ˆç«¶åˆåˆ†æã«åŸºã¥ãï¼‰</p>
              <p><strong>ä¸»è¦æŠ€è¡“èª²é¡Œï¼š</strong></p>
              <ul>
                ${risks.slice(0, 2).map(risk => `<li>${risk}</li>`).join('') || '<li>æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã®è©•ä¾¡ãŒå¿…è¦</li>'}
              </ul>
              <p><strong>ææ¡ˆï¼š</strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å„ªå…ˆã—ã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£çµ±åˆã®å®Ÿç¾å¯èƒ½æ€§ã‚’è©•ä¾¡ã™ã‚‹ã“ã¨ã€‚</p>
            `;
        }
      } else {
        // English
        switch (personaId) {
          case 'pm':
            return `
              <p><strong>Product Positioning:</strong> ${data.idea_summary || 'Innovative solution'}</p>
              <p><strong>Core Strengths:</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>Further analysis needed</li>'}
              </ul>
              <p><strong>Recommendation:</strong> Focus on differentiating core features and establish a clear product roadmap.</p>
            `;
          case 'vc':
            return `
              <p><strong>Market Size:</strong> ${data.market_data?.market_size_current || 'Medium-sized market'}</p>
              <p><strong>Competitive Landscape:</strong> ${competitors.length} main competitors identified</p>
              <p><strong>Investment Value:</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>Business model evaluation needed</li>'}
              </ul>
              <p><strong>Recommendation:</strong> Need clear business model and verifiable growth metrics.</p>
            `;
          case 'growth':
            return `
              <p><strong>Target Users:</strong> ${data.target_users?.slice(0, 2).join(', ') || 'To be defined'}</p>
              <p><strong>Acquisition Channels:</strong> Strategy based on competitive analysis needed</p>
              <p><strong>Growth Opportunities:</strong></p>
              <ul>
                ${opportunities.slice(0, 2).map(opp => `<li>${opp}</li>`).join('') || '<li>Identify growth levers</li>'}
              </ul>
              <p><strong>Recommendation:</strong> Start with MVP and rapidly validate user acquisition and retention strategies.</p>
            `;
          case 'tech':
            return `
              <p><strong>Technical Complexity:</strong> Medium (based on competitive analysis)</p>
              <p><strong>Key Technical Challenges:</strong></p>
              <ul>
                ${risks.slice(0, 2).map(risk => `<li>${risk}</li>`).join('') || '<li>Tech stack evaluation needed</li>'}
              </ul>
              <p><strong>Recommendation:</strong> Prioritize scalable architecture design and evaluate feasibility of third-party integrations.</p>
            `;
        }
      }

      return '<p>No specific insights available for this perspective.</p>';
    }

    // è®¡ç®— Persona è¯„åˆ†
    function calculatePersonaRating(personaId, data) {
      const opportunities = data.opportunities?.length || 0;
      const competitors = data.direct_competitors?.length || 0;
      const risks = data.risks?.length || 0;

      // ç®€å•è¯„åˆ†é€»è¾‘
      let score = 3; // åŸºç¡€åˆ†

      if (opportunities > 3) score += 1;
      if (opportunities > 5) score += 0.5;
      if (competitors < 5) score += 0.5;
      if (risks < 3) score += 0.5;

      return Math.min(5, Math.max(1, Math.round(score)));
    }

    // Back button å¤„ç†
    document.getElementById('backButton').addEventListener('click', () => {
      window.close();
    });

    // Persona è¿‡æ»¤å‡½æ•°
    function filterByPersona() {
      const selectedPersona = document.getElementById('personaSelector').value;
      const allCards = document.querySelectorAll('.persona-card');
      
      console.log(`ğŸ¯ Filtering by persona: ${selectedPersona}`);
      
      if (selectedPersona === 'all') {
        // æ˜¾ç¤ºæ‰€æœ‰è§†è§’
        allCards.forEach(card => {
          card.style.display = 'block';
        });
        console.log('âœ… Showing all personas');
      } else {
        // åªæ˜¾ç¤ºé€‰ä¸­çš„è§†è§’ï¼Œéšè—å…¶ä»–
        allCards.forEach(card => {
          if (card.classList.contains(selectedPersona)) {
            card.style.display = 'block';
            console.log(`âœ… Showing ${selectedPersona} card`);
          } else {
            card.style.display = 'none';
            console.log(`âŒ Hiding ${card.className} card`);
          }
        });
      }
      
      // æ›´æ–°é€‰æ‹©å™¨æ–‡æœ¬ï¼ˆå¤šè¯­è¨€æ”¯æŒï¼‰
      updatePersonaSelectorText(selectedPersona);
    }
    
    // æ›´æ–°é€‰æ‹©å™¨æ–‡æœ¬çš„å¤šè¯­è¨€æ”¯æŒ
    function updatePersonaSelectorText(selectedPersona) {
      const selector = document.getElementById('personaSelector');
      if (!selector) return;
      
      const lang = currentLang || 'zh';
      
      const options = {
        all: {
          zh: 'ğŸ‘¥ æ˜¾ç¤ºæ‰€æœ‰è§†è§’',
          en: 'ğŸ‘¥ Show All Perspectives',
          ja: 'ğŸ‘¥ ã™ã¹ã¦ã®è¦–ç‚¹ã‚’è¡¨ç¤º'
        },
        pm: {
          zh: 'ğŸ“Š äº§å“ç»ç†è§†è§’',
          en: 'ğŸ“Š Product Manager',
          ja: 'ğŸ“Š ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼'
        },
        vc: {
          zh: 'ğŸ’° æŠ•èµ„äººè§†è§’',
          en: 'ğŸ’° Investor',
          ja: 'ğŸ’° æŠ•è³‡å®¶'
        },
        growth: {
          zh: 'ğŸ“ˆ å¢é•¿è´Ÿè´£äººè§†è§’',
          en: 'ğŸ“ˆ Growth Lead',
          ja: 'ğŸ“ˆ ã‚°ãƒ­ãƒ¼ã‚¹ãƒªãƒ¼ãƒ‰'
        },
        tech: {
          zh: 'âš™ï¸ æŠ€æœ¯è´Ÿè´£äººè§†è§’',
          en: 'âš™ï¸ Tech Lead',
          ja: 'âš™ï¸ ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰'
        }
      };
      
      // æ›´æ–°æ‰€æœ‰é€‰é¡¹çš„æ–‡æœ¬
      Array.from(selector.options).forEach(option => {
        const value = option.value;
        if (options[value] && options[value][lang]) {
          option.textContent = options[value][lang];
        }
      });
    }
    
    // é¡µé¢åŠ è½½ååˆå§‹åŒ–é€‰æ‹©å™¨æ–‡æœ¬
    document.addEventListener('DOMContentLoaded', () => {
      updatePersonaSelectorText('all');
    });
  </script>
</body>
</html>
